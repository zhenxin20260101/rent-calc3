<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§Ÿé‡‘è©•å®šç³»çµ± é®ä¿¡/å®‰æ± v16.1 </title>
    <style>
        :root { --primary: #2c3e50; --bg: #f8fafc; --accent: #3498db; --danger: #e74c3c; --success: #27ae60; }
        * { box-sizing: border-box; }
        body { font-family: -apple-system, "Segoe UI", "Microsoft JhengHei", sans-serif; background-color: var(--bg); margin: 0; padding: 10px; color: #334155; }
        .container { max-width: 1200px; margin: auto; background: white; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); overflow: hidden; }
        .header { background: var(--primary); color: white; padding: 20px; text-align: center; }
        .main-grid { display: grid; grid-template-columns: 1fr; }
        @media (min-width: 992px) { .main-grid { grid-template-columns: 1.1fr 0.9fr; } }
        .input-side { padding: 20px; border-bottom: 1px solid #edf2f7; }
        @media (min-width: 992px) { .input-side { border-bottom: none; border-right: 1px solid #edf2f7; } }
        .result-side { padding: 20px; background: #fafbfc; }
        .section-title { font-size: 1.1rem; color: var(--accent); font-weight: 800; margin: 15px 0 10px 0; border-left: 5px solid var(--accent); padding-left: 12px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 5px; }
        label { display: block; margin-bottom: 5px; font-size: 0.85rem; font-weight: bold; color: #64748b; }
        select, input { width: 100%; height: 42px; padding: 0 10px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 1rem; margin-bottom: 10px; }
        .drawer-btn { background: #f0f9ff; border: 2px dashed #3498db; color: #2980b9; width: 100%; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: bold; display: flex; justify-content: space-between; margin-bottom: 15px; }
        #areaCalculator { display: none; background: #fff; border: 1px solid #e2e8f0; border-radius: 12px; padding: 12px; margin-bottom: 15px; }
        .calc-table { width: 100%; border-collapse: collapse; font-size: 0.75rem; }
        .calc-table th, .calc-table td { padding: 5px; border-bottom: 1px solid #f1f5f9; text-align: center; }
        .calc-table input { height: 30px; border-width: 1px; color: var(--danger); text-align: center; margin-bottom: 0; }
        .result-card { background: white; border: 2px solid #e0f2fe; border-radius: 16px; padding: 15px; }
        .res-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9rem; border-bottom: 1px dashed #eee; padding-bottom: 5px; }
        .res-max-val { font-size: 2.2rem; font-weight: 900; color: var(--danger); text-align: right; display: block; }
        #statusBox { text-align: center; padding: 15px; border-radius: 12px; font-weight: 800; margin-top: 15px; }
        .status-init { background: #f1f5f9; color: #94a3b8; }
        .status-normal { background: #dcfce7; color: #166534; border: 2px solid #86efac; }
        .status-danger { background: #fee2e2; color: #991b1b; border: 2px solid #fca5a5; }
        .btn-apply { background: var(--accent); color: white; border: none; padding: 12px; border-radius: 10px; width: 100%; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="header"><h2>ç§Ÿé‡‘è©•å®šç³»çµ± é®ä¿¡/å®‰æ± v16.1</h2></div>
    <div class="main-grid">
        <div class="input-side">
            <button class="drawer-btn" onclick="toggleDrawer()">
                <span>ğŸ“ é¢ç©æ›ç®— (ä¾è¬„æœ¬å¡«å…¥)</span><span id="drawerArrow">â–¼</span>
            </button>
            <div id="areaCalculator">
                <table class="calc-table">
                    <thead><tr><th>é …ç›®</th><th>é¢ç©(mÂ²)</th><th>åˆ†æ¯</th><th>åˆ†å­</th></tr></thead>
                    <tbody>
                        <tr><td>ä¸»å»ºç‰©</td><td><input type="number" id="mMain" value="63.66" oninput="runAreaCalc()"></td><td>1</td><td>1</td></tr>
                        <tr><td>é™½å°</td><td><input type="number" id="mBal" value="18.25" oninput="runAreaCalc()"></td><td>1</td><td>1</td></tr>
                        <tr><td>å…¶ä»–é™„å±¬</td><td><input type="number" id="mOth" value="2.2" oninput="runAreaCalc()"></td><td>1</td><td>1</td></tr>
                        <tr><td>å…±æœ‰ 1</td><td><input type="number" id="mS1" value="5699.05" oninput="runAreaCalc()"></td><td><input type="number" id="dS1" value="100000" oninput="runAreaCalc()"></td><td><input type="number" id="nS1" value="256" oninput="runAreaCalc()"></td></tr>
                        <tr><td>å…±æœ‰ 2</td><td><input type="number" id="mS2" value="260.88" oninput="runAreaCalc()"></td><td><input type="number" id="dS2" value="10000" oninput="runAreaCalc()"></td><td><input type="number" id="nS2" value="425" oninput="runAreaCalc()"></td></tr>
                        <tr><td style="color:blue;">è»Šä½</td><td><input type="number" id="mCar" value="0" oninput="runAreaCalc()"></td><td><input type="number" id="dCar" value="1" oninput="runAreaCalc()"></td><td><input type="number" id="nCar" value="0" oninput="runAreaCalc()"></td></tr>
                    </tbody>
                </table>
                <p style="text-align:right; font-weight:bold; color:red; margin:10px 0;">è¨ˆç®—åªæ•¸ï¼š<span id="outPing">0</span> åª</p>
                <button class="btn-apply" style="background:#64748b;" onclick="applyArea()">å¸¶å…¥è©•å®šåªæ•¸</button>
            </div>

            <div class="section-title">åŸºæœ¬è³‡æ–™</div>
            <div class="form-row">
                <div><label>ç¸£å¸‚</label><select id="city" onchange="initDistricts()"><option value="æ¡ƒåœ’å¸‚">æ¡ƒåœ’å¸‚</option><option value="å½°åŒ–ç¸£">å½°åŒ–ç¸£</option><option value="å—æŠ•ç¸£">å—æŠ•ç¸£</option></select></div>
                <div><label>è¡Œæ”¿å€</label><select id="district" onchange="calculate()"></select></div>
            </div>
            <div class="form-row">
                <div><label>è¨ˆç®—åªæ•¸</label><input type="number" id="area" step="0.01" oninput="calculate()"></div>
                <div><label>é¡å‹</label><select id="caseType" onchange="calculate()"><option value="æ•´å±¤">æ•´å±¤</option><option value="å¥—æˆ¿">å¥—æˆ¿</option></select></div>
            </div>
            <div class="form-row">
                <div><label>æ—¥æœŸ</label><input type="text" id="buildDate" placeholder="0830101" oninput="calcAgeByDate()"></div>
                <div><label>å±‹é½¡</label><input type="number" id="age" value="0" oninput="calculate()"></div>
            </div>

            <div class="section-title">å€ä½èˆ‡è£ä¿®èª¿æ•´</div>
            <div class="form-row">
                <div><label>å€ä½èª¿æ•´ç‡</label><select id="adjLoc" onchange="calculate()"><option value="0">ä¸­ä¸‹å€ä½(0%)</option><option value="0.03">ä¸­ä¸Šå€ä½(3%)</option><option value="0.05">å„ªè³ªå€ä½(5%)</option></select></div>
                <div><label>è£ä¿®èª¿æ•´ç‡</label><select id="adjDec" onchange="calculate()"><option value="0">ç„¡è£ä¿®(0%)</option><option value="0.03">ç°¡æ˜“è£ä¿®(3%)</option><option value="0.05">ä¸­ç­‰è£ä¿®(5%)</option></select></div>
            </div>
            <label>å¯¦æ”¶ç§Ÿé‡‘</label><input type="number" id="rent" oninput="calculate()">
        </div>

        <div class="result-side">
            <div class="result-card">
                <div class="res-row"><span>åŸºæº–å–®åƒ¹</span><span id="resRef">0</span></div>
                <div class="res-row"><span>åŠ æˆå¾Œå–®åƒ¹</span><span id="resAdj" style="font-weight:800;color:var(--accent);">0</span></div>
                <div style="text-align:right;margin-top:15px;"><label>æ ¸å®šç§Ÿé‡‘ä¸Šé™</label><span class="res-max-val" id="resMax">0</span></div>
            </div>
            <div id="statusBox" class="status-init">è«‹è¼¸å…¥è©•å®šè³‡æ–™</div>
        </div>
    </div>
</div>

<script>
const masterData = {
    "æ¡ƒåœ’å¸‚": {
        "æ¡ƒåœ’å€": { "æ•´å±¤": [780,770,755,735,720,700,680,650,620], "å¥—æˆ¿": [1120,1100,1080,1055,1025,1000,970,930,885] },
        "ä¸­å£¢å€": { "æ•´å±¤": [770,760,745,725,705,685,670,640,610], "å¥—æˆ¿": [1080,1065,1045,1020,995,965,940,900,855] },
        "é¾œå±±å€": { "æ•´å±¤": [855,840,825,805,785,760,740,710,675], "å¥—æˆ¿": [1225,1205,1185,1155,1125,1095,1065,1020,970] },
        "è˜†ç«¹å€": { "æ•´å±¤": [745,735,720,705,685,665,645,620,590], "å¥—æˆ¿": [1180,1160,1140,1110,1080,1050,1020,980,935] },
        "å…«å¾·å€": { "æ•´å±¤": [735,720,710,690,675,655,635,610,580], "å¥—æˆ¿": [1045,1030,1010,985,960,935,905,870,830] },
        "å¹³é®å€": { "æ•´å±¤": [720,710,700,680,660,645,625,600,570], "å¥—æˆ¿": [900,885,870,850,830,805,780,750,715] },
        "å¤§åœ’å€": { "æ•´å±¤": [735,720,710,690,675,655,635,610,580], "å¥—æˆ¿": [1045,1030,1010,985,960,935,905,870,830] },
        "è§€éŸ³å€": { "æ•´å±¤": [700,685,675,660,640,625,605,580,555], "å¥—æˆ¿": [900,885,870,850,830,805,780,750,715] },
        "æ¥Šæ¢…å€": { "æ•´å±¤": [615,605,595,580,565,550,535,510,485], "å¥—æˆ¿": [830,815,805,780,760,740,720,690,660] },
        "é¾æ½­å€": { "æ•´å±¤": [580,570,560,545,530,515,500,480,460], "å¥—æˆ¿": [830,815,805,780,760,740,720,690,660] },
        "å¤§æºªå€": { "æ•´å±¤": [565,555,550,535,520,505,490,470,450], "å¥—æˆ¿": [710,700,685,670,650,635,615,590,565] },
        "æ–°å±‹å€": { "æ•´å±¤": [580,570,560,545,530,515,500,480,460], "å¥—æˆ¿": [625,615,605,590,575,560,545,520,495] },
        "å¾©èˆˆå€": { "æ•´å±¤": [375,370,360,355,345,335,325,310,295], "å¥—æˆ¿": [385,380,375,365,355,345,335,320,305] }
    },
    "å½°åŒ–ç¸£": {
        "å½°åŒ–å¸‚": { "æ•´å±¤": [600,590,580,565,550,535,520,500,475], "å¥—æˆ¿": [745,735,720,705,685,665,645,620,590] },
        "å“¡æ—å¸‚": { "æ•´å±¤": [600,590,580,565,550,535,520,500,475], "å¥—æˆ¿": [675,665,650,635,620,600,585,560,535] },
        "å’Œç¾é®": { "æ•´å±¤": [555,545,535,520,510,495,480,460,440], "å¥—æˆ¿": [565,555,550,535,520,505,490,470,450] },
        "é¹¿æ¸¯é®": { "æ•´å±¤": [505,500,490,475,465,450,440,420,400], "å¥—æˆ¿": [565,555,550,535,520,505,490,470,450] }
    },
    "å—æŠ•ç¸£": {
        "è‰å±¯é®": { "æ•´å±¤": [625,615,605,590,575,560,545,520,495], "å¥—æˆ¿": [660,650,640,625,605,590,575,550,525] },
        "å—æŠ•å¸‚": { "æ•´å±¤": [600,590,580,565,550,535,520,500,475], "å¥—æˆ¿": [660,650,640,625,605,590,575,550,525] },
        "åŸ”é‡Œé®": { "æ•´å±¤": [580,570,560,545,530,515,500,480,460], "å¥—æˆ¿": [600,590,580,565,550,535,520,500,475] }
    }
};

const otherCh = ["æºªæ¹–é®","ç”°ä¸­é®","åŒ—æ–—é®","äºŒæ—é®","ç§€æ°´é„‰","å¤§æ‘é„‰","ç·šè¥¿é„‰","èŠ±å£‡é„‰","ä¼¸æ¸¯é„‰","åŸ”å¿ƒé„‰","åŸ”é¹½é„‰","åŸ¤é ­é„‰","æ°¸é–é„‰","æºªå·é„‰","ç”°å°¾é„‰","ç¦èˆˆé„‰","ç«¹å¡˜é„‰","èŠ³è‹‘é„‰","ç¤¾é ­é„‰"];
const otherNt = ["ç«¹å±±é®","åé–“é„‰","æ°´é‡Œé„‰","é›†é›†é®","é­šæ± é„‰","é¹¿è°·é„‰","ä¸­å¯®é„‰","åœ‹å§“é„‰","ä¿¡ç¾©é„‰","ä»æ„›é„‰"];

function toggleDrawer() {
    const d = document.getElementById('areaCalculator');
    d.style.display = (d.style.display==='block')?'none':'block';
    document.getElementById('drawerArrow').innerText = (d.style.display==='block')?'â–²':'â–¼';
}

function runAreaCalc() {
    const pri = ["mMain", "mBal", "mOth"].reduce((acc, id) => acc + parseFloat(document.getElementById(id).value || 0), 0);
    const getSub = (m, d, n) => parseFloat(document.getElementById(m).value||0) * (parseFloat(document.getElementById(n).value||0)/parseFloat(document.getElementById(d).value||1));
    const pub = getSub('mS1','dS1','nS1') + getSub('mS2','dS2','nS2');
    const car = getSub('mCar','dCar','nCar');
    const finalPing = (pri + pub - car) * 0.3025;
    document.getElementById('outPing').innerText = finalPing.toFixed(2);
}

function applyArea() {
    document.getElementById('area').value = document.getElementById('outPing').innerText;
    toggleDrawer(); calculate();
}

function calcAgeByDate() {
    const s = document.getElementById('buildDate').value;
    if (s.length >= 7) {
        document.getElementById('age').value = Math.max(0, (new Date().getFullYear() - 1911) - parseInt(s.substring(0,3)));
        calculate();
    }
}

function initDistricts() {
    const city = document.getElementById('city').value;
    const distSelect = document.getElementById('district');
    distSelect.innerHTML = "";
    let list = Object.keys(masterData[city]);
    if (city === "å½°åŒ–ç¸£") list = list.concat(otherCh);
    if (city === "å—æŠ•ç¸£") list = list.concat(otherNt);
    list.forEach(d => { let opt = document.createElement('option'); opt.value = d; opt.innerText = d; distSelect.appendChild(opt); });
    calculate();
}

function calculate() {
    const city = document.getElementById('city').value, dist = document.getElementById('district').value, type = document.getElementById('caseType').value;
    const age = parseFloat(document.getElementById('age').value) || 0, area = parseFloat(document.getElementById('area').value) || 0, rent = parseFloat(document.getElementById('rent').value) || 0;
    const adjL = parseFloat(document.getElementById('adjLoc').value), adjD = parseFloat(document.getElementById('adjDec').value);

    const priceList = masterData[city][dist] ? masterData[city][dist][type] : (type === "æ•´å±¤" ? [400,390,385,375,365,355,345,330,315] : [385,380,375,365,355,345,335,320,305]);
    const basePrice = priceList[Math.min(8, Math.floor(age / 5))];
    const adjustedPrice = basePrice * (1 + adjL + adjD);
    
    document.getElementById('resRef').innerText = basePrice + " å…ƒ/åª";
    document.getElementById('resAdj').innerText = Math.round(adjustedPrice) + " å…ƒ/åª";
    
    let cap = (city === "æ¡ƒåœ’å¸‚") ? (type === "æ•´å±¤" ? 35000 : 21000) : (type === "æ•´å±¤" ? 22000 : 13000);
    const maxVal = Math.min(adjustedPrice * area, cap);
    document.getElementById('resMax').innerText = Math.round(maxVal).toLocaleString() + " å…ƒ";

    const box = document.getElementById('statusBox');
    if (rent === 0 || area === 0) { box.innerText = "å¾…è¼¸å…¥é—œéµæ•¸æ“š"; box.className = "status-init"; }
    else if (rent > maxVal) { box.innerText = "âŒ ä¸ç¬¦åˆ (ç§Ÿé‡‘è¶…é¡)"; box.className = "status-danger"; }
    else { box.innerText = "âœ… ç¬¦åˆè©•å®šæ¨™æº–"; box.className = "status-normal"; }
}

initDistricts(); runAreaCalc();
</script>
</body>
</html>

